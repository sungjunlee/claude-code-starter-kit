# Claude Code settings for Python development
# Optimized configuration with smart automation

# Global settings
[ui]
pretty_print = true

# ğŸš€ Primary workflow: Format and validate Python files
[[hooks]]
event = "PostToolUse"
[hooks.matcher]
tool_name = "Edit"
file_paths = ["*.py", "src/**/*.py"]
command = """
echo 'ğŸš€ Formatting Python files...'
ruff check --fix $CLAUDE_FILE_PATHS --quiet && ruff format $CLAUDE_FILE_PATHS --quiet
echo 'âœ… Formatting complete'
"""

# ğŸ§ª Smart testing: Run tests when source or test files change
[[hooks]]
event = "PostToolUse"
run_in_background = true
[hooks.matcher]
tool_name = "Edit"
file_paths = ["src/**/*.py", "tests/**/*.py"]
command = """
if [[ "$CLAUDE_FILE_PATHS" =~ tests/ ]]; then
  echo 'ğŸ§ª Running tests with coverage...'
  pytest --cov=src --cov-report=term-missing -q
else
  echo 'ğŸ§ª Running quick tests...'
  pytest --tb=short -q
fi
"""

# ğŸ“¦ Dependency management: Sync when project config changes
[[hooks]]
event = "PostToolUse"
[hooks.matcher]
tool_name = "Edit"
file_paths = ["pyproject.toml"]
command = "echo 'ğŸ“¦ Syncing dependencies...' && uv lock --quiet && uv sync --quiet && echo 'âœ… Dependencies synchronized'"

# ğŸ” Quality checks: Type checking and security (background)
[[hooks]]
event = "PostToolUse"
run_in_background = true
[hooks.matcher]
tool_name = "Edit"
file_paths = ["src/**/*.py"]
command = """
echo 'ğŸ” Running quality checks...'
mypy src/ --no-error-summary 2>/dev/null && echo '  âœ… Type check passed' || echo '  âš ï¸  Type issues found'
bandit -r src/ -f txt -q 2>/dev/null && echo '  âœ… Security check passed' || echo '  âš ï¸  Security issues found'
"""

# ğŸ“š Documentation update: Conditional and smart
[[hooks]]
event = "PostToolUse"
run_in_background = true
[hooks.matcher]
tool_name = "Edit"
file_paths = ["src/**/*.py"]
command = "[ -f scripts/update_docs.sh ] && bash scripts/update_docs.sh 2>/dev/null || true"

# ğŸ’¡ Code quality hints: Check for unused code (non-blocking)
[[hooks]]
event = "PostToolUse"
run_in_background = true
[hooks.matcher]
tool_name = "Edit"
file_paths = ["src/**/*.py"]
command = """
if command -v autoflake &> /dev/null; then
  autoflake --check --remove-unused-variables $CLAUDE_FILE_PATHS 2>&1 | grep -q "would be reformatted" && \
  echo "ğŸ’¡ Tip: Run '/py-clean' to remove unused code" || true
fi
"""

# ğŸ“ˆ Project health: Lightweight status check
[[hooks]]
event = "UserPromptSubmit"
command = "uv sync --quiet 2>/dev/null && echo 'ğŸ“ˆ Ready âœ…' || true"